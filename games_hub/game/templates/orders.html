{% extends "base.html" %}
{% block content %}
{% if not user.is_authenticated %}
  <div class="bg-yellow-100 text-yellow-800 border border-yellow-300 p-4 rounded mb-6">
    You need to <a href="{% url 'login' %}" class="underline text-blue-600">log in</a> to view your orders.
  </div>
{% else %}
  {% for order in orders %}
    <div class="max-w-3xl mx-auto p-6 bg-white shadow-md rounded-md mb-6 relative">
  <!-- Top-right button -->
  {% if order.order_status == "completed" %}
  <form method="post" action="{% url 'remove-order' order.pk %}" class="absolute top-4 right-4">
    {% csrf_token %}
    <button type="submit" class="text-sm px-4 py-2 border bg-red-700 transform transition-transform hover:scale-105">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/></svg>
    </button>
  </form>
  {% endif %}
      <h1 class="text-2xl font-bold mb-4">Order #{{ order.order_id }}</h1>
      <p class="text-sm text-gray-600 mb-2">Placed on: {{ order.order_date|date:"F j, Y, g:i a" }}</p>
      
      <ul class="space-y-4">
        {% for item in order.items.all %}
          <li class="grid grid-cols-4 items-center gap-4 border-b pb-4">
            <div class="col-span-3 font-medium">{{ item.game.title }} x{{item.quantity}} ({{item.item_price}})</div>
            <div class="col-span-1 font-semibold text-right">€{{ item.price|floatformat:2 }}</div>
          </li>
        {% endfor %}
      </ul>
      {% if order.order_status == "pending" %}
      <p class="flex gap-2 relative top-11 left-0  font-semibold text-left text-orange-500" >Status: {{ order.get_order_status_display}} <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M160 64C142.3 64 128 78.3 128 96C128 113.7 142.3 128 160 128L160 139C160 181.4 176.9 222.1 206.9 252.1L274.8 320L206.9 387.9C176.9 417.9 160 458.6 160 501L160 512C142.3 512 128 526.3 128 544C128 561.7 142.3 576 160 576L480 576C497.7 576 512 561.7 512 544C512 526.3 497.7 512 480 512L480 501C480 458.6 463.1 417.9 433.1 387.9L365.2 320L433.1 252.1C463.1 222.1 480 181.4 480 139L480 128C497.7 128 512 113.7 512 96C512 78.3 497.7 64 480 64L160 64zM416 501L416 512L224 512L224 501C224 475.5 234.1 451.1 252.1 433.1L320 365.2L387.9 433.1C405.9 451.1 416 475.5 416 501z"/></svg></p>
      {% else %}
      <p class="flex gap-2 relative top-11 left-0 font-semibold text-left text-green-600">Status: {{ order.get_order_status_display }}  <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#16a34a" d="M160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96L160 96zM404.4 276.7L324.4 404.7C320.2 411.4 313 415.6 305.1 416C297.2 416.4 289.6 412.8 284.9 406.4L236.9 342.4C228.9 331.8 231.1 316.8 241.7 308.8C252.3 300.8 267.3 303 275.3 313.6L302.3 349.6L363.7 251.3C370.7 240.1 385.5 236.6 396.8 243.7C408.1 250.8 411.5 265.5 404.4 276.8z"/></svg></p>
      {% endif %}
      <p class="mt-4 font-semibold text-right">Total: €{{ order.total_price|floatformat:2 }}</p>

      
    </div>
  {% empty %}
    <div class="max-w-3xl mx-auto p-6 bg-white shadow-md rounded-md">
      <p>You have no orders yet.</p>
    </div>
  {% endfor %}
{% endif %}
{% endblock %}
